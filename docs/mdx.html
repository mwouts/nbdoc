---

title: Preprocessors For MDX


keywords: fastai
sidebar: home_sidebar

summary: "Custom preprocessors that help convert notebook content into MDX"
description: "Custom preprocessors that help convert notebook content into MDX"
nb_path: "nbs/mdx.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/mdx.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="InjectMeta" class="doc_header"><code>class</code> <code>InjectMeta</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>InjectMeta</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Allows you to inject metadata into a cell for further preprocessing with a comment.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To inject metadata make a comment in a cell with the following pattern: '#cell_meta:{key=value}'</p>
<p>For example, consider the following code:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_test_file</span> <span class="o">=</span> <span class="s1">&#39;test_files/hello_world.ipynb&#39;</span>
<span class="n">first_cell</span> <span class="o">=</span> <span class="n">read_nb</span><span class="p">(</span><span class="n">_test_file</span><span class="p">)[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#cell_meta:show_steps=start,train
print(&#39;hello world&#39;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At the moment, this cell has no metadata:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">first_cell</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, after we process this notebook with <a href="/nbdoc/mdx.html#InjectMeta"><code>InjectMeta</code></a>, the appropriate metadata will be injected:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">NotebookExporter</span><span class="o">.</span><span class="n">preprocessors</span> <span class="o">=</span> <span class="p">[</span><span class="n">InjectMeta</span><span class="p">]</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">NotebookExporter</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">cells</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="n">_test_file</span><span class="p">)</span>
<span class="n">first_cell</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">cells</span><span class="p">)[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">first_cell</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;nbdoc&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;show_steps&#39;</span><span class="p">:</span> <span class="s1">&#39;start,train&#39;</span><span class="p">}}</span>
<span class="n">first_cell</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;nbdoc&#39;: {&#39;show_steps&#39;: &#39;start,train&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="StripAnsi" class="doc_header"><code>class</code> <code>StripAnsi</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L42" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>StripAnsi</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Strip Ansi Characters.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Gets rid of colors that are streamed from standard out, which can interfere with static site generators:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">StripAnsi</span><span class="p">],</span> <span class="s1">&#39;test_files/run_flow.ipynb&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">_re_ansi_escape</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="InsertWarning" class="doc_header"><code>class</code> <code>InsertWarning</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L65" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>InsertWarning</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Insert Autogenerated Warning Into Notebook after the first cell.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This preprocessor inserts a warning in the markdown destination that the file is autogenerated.  This warning is inserted in the second cell so we do not interfere with front matter.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InsertWarning</span><span class="p">],</span> <span class="s1">&#39;test_files/hello_world.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;&lt;!--- WARNING: THIS FILE WAS AUTOGENERATED!&quot;</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#cell_meta:show_steps=start,train
print(&#39;hello world&#39;)
```

    hello world


&lt;!--- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location &amp; name as this file.--&gt;


```python

```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RmEmptyCode" class="doc_header"><code>class</code> <code>RmEmptyCode</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L79" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RmEmptyCode</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Remove empty code cells.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice how this notebook has an empty code cell at the end:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/hello_world.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#cell_meta:show_steps=start,train
print(&#39;hello world&#39;)
```

    hello world



```python

```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <a href="/nbdoc/mdx.html#RmEmptyCode"><code>RmEmptyCode</code></a> these empty code cells are stripped from the markdown:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">RmEmptyCode</span><span class="p">],</span> <span class="s1">&#39;test_files/hello_world.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;```python&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#cell_meta:show_steps=start,train
print(&#39;hello world&#39;)
```

    hello world


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MetaflowPreamble" class="doc_header"><code>class</code> <code>MetaflowPreamble</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L87" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MetaflowPreamble</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Remove the preamble from Metaflow output.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When you run a metaflow Flow, you are presented with a fair amount of boilerpalte before the job starts running that is not necesary to show in the documentation:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/run_flow.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```
!python myflow.py run
```

    <span class="ansi-magenta-intense-fg ansi-bold">Metaflow 2.5.0.post6+git62f5e52</span><span class="ansi-magenta-fg"> executing </span><span class="ansi-red-intense-fg ansi-bold">MyFlow</span><span class="ansi-magenta-fg"> for </span><span class="ansi-red-intense-fg ansi-bold">user:hamel</span>
    <span class="ansi-magenta-fg">Validating your flow...</span>
    <span class="ansi-green-intense-fg ansi-bold">    The graph looks good!</span>
    <span class="ansi-magenta-fg">Running pylint...</span>
    <span class="ansi-green-intense-fg ansi-bold">    Pylint is happy!</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.075 </span><span class="ansi-bold">Workflow starting (run-id 1644962274071949):</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.084 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.703 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span>this is the start
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.771 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.779 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.412 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.483 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.491 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.121 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span>this is the end
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.189 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.190 </span><span class="ansi-bold">Done!</span>
    

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We want to strip this output as well as the superflous clolors, which we can do with the <a href="/nbdoc/mdx.html#MetaflowPreamble"><code>MetaflowPreamble</code></a> preprocessor:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">MetaflowPreamble</span><span class="p">],</span> <span class="s1">&#39;test_files/run_flow.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;Validating your flow...&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```
!python myflow.py run
```

    <span class="ansi-magenta-fg">2022-02-15 13:57:54.075 </span><span class="ansi-bold">Workflow starting (run-id 1644962274071949):</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.084 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.703 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span>this is the start
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.771 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.779 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.412 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.483 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.491 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.121 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span>this is the end
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.189 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.190 </span><span class="ansi-bold">Done!</span>
    

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="UpdateTags" class="doc_header"><code>class</code> <code>UpdateTags</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L99" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>UpdateTags</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Create cell tags based upon comment <code>#cell_meta:tags=&lt;tag&gt;</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_foo">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Consider this python notebook prior to processing.  The comments can be used configure the visibility of cells.</p>
<ul>
<li><code>#cell_meta:tags=remove_output</code> will just remove the output</li>
<li><code>#cell_meta:tags=remove_input</code> will just remove the input</li>
<li><code>#cell_meta:tags=remove_cell</code> will remove both the input and output</li>
</ul>
<p>Note that you can use <code>#cell_meta:tag</code> or <code>#cell_meta:tags</code> as they are both aliases for the same thing.  Here is a notebook before preprocessing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/visibility.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre># Configuring Cell Visibility

#### Cell with the comment `#cell_meta:tag=remove_output`


```
#cell_meta:tag=remove_output
print(&#39;the output is removed, so you can only see the print statement.&#39;)
```

    the output is removed, so you can only see the print statement.


#### Cell with the comment `#cell_meta:tag=remove_input`


```
#cell_meta:tag=remove_input
print(&#39;hello, you cannot see the code that created me.&#39;)
```

    hello, you cannot see the code that created me.


#### Cell with the comment `#cell_meta:tag=remove_cell`


```
#cell_meta:tag=remove_cell
print(&#39;you will not be able to see this cell at all&#39;)
```

    you will not be able to see this cell at all



```
#cell_meta:tags=remove_input,remove_output
print(&#39;you will not be able to see this cell at all either&#39;)
```

    you will not be able to see this cell at all either


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#UpdateTags"><code>UpdateTags</code></a> is meant to be used with <a href="/nbdoc/mdx.html#InjectMeta"><code>InjectMeta</code></a> and <code>TagRemovePreprocessor</code> to configure the visibility of cells in rendered docs.  Here you can see what the notebook looks like after pre-processing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_test_file</span> <span class="o">=</span> <span class="s1">&#39;test_files/visibility.ipynb&#39;</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">TagRemovePreprocessor</span><span class="o">.</span><span class="n">remove_cell_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;remove_cell&quot;</span><span class="p">,)</span>
<span class="n">c</span><span class="o">.</span><span class="n">TagRemovePreprocessor</span><span class="o">.</span><span class="n">remove_all_outputs_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;remove_output&#39;</span><span class="p">,)</span>
<span class="n">c</span><span class="o">.</span><span class="n">TagRemovePreprocessor</span><span class="o">.</span><span class="n">remove_input_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;remove_input&#39;</span><span class="p">,)</span>
<span class="n">c</span><span class="o">.</span><span class="n">MarkdownExporter</span><span class="o">.</span><span class="n">preprocessors</span> <span class="o">=</span> <span class="p">[</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">UpdateTags</span><span class="p">,</span> <span class="n">TagRemovePreprocessor</span><span class="p">]</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">MarkdownExporter</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="n">_test_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># show the results</span>
<span class="k">assert</span> <span class="s1">&#39;you will not be able to see this cell at all either&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre># Configuring Cell Visibility

#### Cell with the comment `#cell_meta:tag=remove_output`


```
#cell_meta:tag=remove_output
print(&#39;the output is removed, so you can only see the print statement.&#39;)
```

#### Cell with the comment `#cell_meta:tag=remove_input`

    hello, you cannot see the code that created me.


#### Cell with the comment `#cell_meta:tag=remove_cell`

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MetaflowSelectSteps" class="doc_header"><code>class</code> <code>MetaflowSelectSteps</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L111" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MetaflowSelectSteps</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Hide Metaflow steps in output based on cell metadata.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#MetaflowSelectSteps"><code>MetaflowSelectSteps</code></a> is meant to be used with <a href="/nbdoc/mdx.html#InjectMeta"><code>InjectMeta</code></a> to only show specific steps in the output logs from Metaflow.</p>
<p>For example, if you want to only show the <code>start</code> and <code>train</code> steps in your flow, you would annotate your cell with the following pattern: <code>#cell_meta:show_steps=&lt;step_name&gt;</code></p>
<p>Note that <code>show_step</code> and <code>show_steps</code> are aliases for convenience, so you don't need to worry about the <code>s</code> at the end.</p>
<p>In the below example, <code>#cell_meta:show_steps=start,train</code> shows the <code>start</code> and <code>train</code> steps, whereas <code>#cell_meta:show_steps=train</code> only shows the <code>train</code> step:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">MetaflowSelectSteps</span><span class="p">],</span> 
                        <span class="s1">&#39;test_files/run_flow_showstep.ipynb&#39;</span><span class="p">,</span> 
                        <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```
#cell_meta:show_steps=start,train
!python myflow.py run
```

    <span class="ansi-magenta-fg">2022-02-15 14:01:14.810 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.433 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span>this is the start
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.500 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.507 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:16.123 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:01:16.188 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...


```
#cell_meta:show_steps=train
!python myflow.py run
```

    <span class="ansi-magenta-fg">2022-02-15 14:01:18.924 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:19.566 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:01:19.632 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="WriteTitle" class="doc_header"><code>class</code> <code>WriteTitle</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L132" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>WriteTitle</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Modify the code-fence with the filename upon %%writefile cell magic.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#WriteTitle"><code>WriteTitle</code></a> creates the proper code-fence with a title in the situation where the <code>%%writefile</code> magic is used.</p>
<p>For example, here are contents before pre-processing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/writefile.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>A test notebook


```python
%%writefile myflow.py
from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.train)
    
    @step
    def train(self):
        print(&#39;the train step&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```

    Overwriting myflow.py



```python
%%writefile hello.txt

Hello World
```

    Overwriting hello.txt


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we use <a href="/nbdoc/mdx.html#WriteTitle"><code>WriteTitle</code></a>, you will see the code-fence will change appropriately:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">WriteTitle</span><span class="p">],</span> <span class="s1">&#39;test_files/writefile.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;```py title=&quot;myflow.py&quot;&#39;</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s1">&#39;```txt title=&quot;hello.txt&quot;&#39;</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>A test notebook


```py title=&#34;myflow.py&#34;
%%writefile myflow.py
from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.train)
    
    @step
    def train(self):
        print(&#39;the train step&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```


```txt title=&#34;hello.txt&#34;
%%writefile hello.txt

Hello World
```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CleanMagics" class="doc_header"><code>class</code> <code>CleanMagics</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L146" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CleanMagics</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>A preprocessor to remove cell magic commands and #cell_meta: comments</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#CleanMagics"><code>CleanMagics</code></a> strips magic cell commands <code>%%</code> so they do not appear in rendered markdown files:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">WriteTitle</span><span class="p">,</span> <span class="n">CleanMagics</span><span class="p">],</span> <span class="s1">&#39;test_files/writefile.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;</span><span class="si">%%</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>A test notebook


```py title=&#34;myflow.py&#34;
from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.train)
    
    @step
    def train(self):
        print(&#39;the train step&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```


```txt title=&#34;hello.txt&#34;
Hello World
```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is how <a href="/nbdoc/mdx.html#CleanMagics"><code>CleanMagics</code></a> Works on the file with the Metaflow log outputs from earlier, we can see that the <code>#cell_meta</code> comments are gone:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">MetaflowSelectSteps</span><span class="p">,</span> <span class="n">CleanMagics</span><span class="p">],</span> 
                        <span class="s1">&#39;test_files/run_flow_showstep.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```
!python myflow.py run
```

    <span class="ansi-magenta-fg">2022-02-15 14:01:14.810 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.433 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span>this is the start
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.500 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.507 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:16.123 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:01:16.188 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...


```
!python myflow.py run
```

    <span class="ansi-magenta-fg">2022-02-15 14:01:18.924 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:19.566 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:01:19.632 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BashIdentify" class="doc_header"><code>class</code> <code>BashIdentify</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L156" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BashIdentify</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>A preprocessor to identify bash commands and mark them appropriately</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we issue a shell command in a notebook with <code>!</code>, we need to change the code-fence from <code>python</code> to <code>bash</code> and remove the <code>!</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">MetaflowPreamble</span><span class="p">,</span> <span class="n">BashIdentify</span><span class="p">],</span> <span class="s1">&#39;test_files/run_flow.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;```bash&quot;</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s1">&#39;!python&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```bash
python myflow.py run
```

    <span class="ansi-magenta-fg">2022-02-15 13:57:54.075 </span><span class="ansi-bold">Workflow starting (run-id 1644962274071949):</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.084 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.703 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span>this is the start
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.771 </span><span class="ansi-green-fg">[1644962274071949/start/1 (pid 46643)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:54.779 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.412 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.483 </span><span class="ansi-green-fg">[1644962274071949/train/2 (pid 46648)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:55.491 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.121 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span>this is the end
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.189 </span><span class="ansi-green-fg">[1644962274071949/end/3 (pid 46653)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 13:57:56.190 </span><span class="ansi-bold">Done!</span>
    

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Composing-Preprocessors-Into-A-Pipeline">Composing Preprocessors Into A Pipeline<a class="anchor-link" href="#Composing-Preprocessors-Into-A-Pipeline"> </a></h2><p>Lets see how you can compose all of these preprocessors together to process notebooks appropriately:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mdx_exporter" class="doc_header"><code>get_mdx_exporter</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L167" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mdx_exporter</code>(<strong><code>template_file</code></strong>=<em><code>'ob.tpl'</code></em>)</p>
</blockquote>
<p>A mdx notebook exporter which composes many pre-processors together.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#get_mdx_exporter"><code>get_mdx_exporter</code></a> combines all of the previous preprocessors, along with the built in <code>TagRemovePreprocessor</code> to allow for hiding cell inputs/outputs based on cell tags.  Here is an example of markdown generated from a notebook with the default preprocessing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/example_input.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>---
title: my hello page title
description: my hello page description
hide_table_of_contents: true
---
## This is a test notebook

This is a shell command:


```python
! echo hello
```

    hello


We are writing a python script to disk:


```python
%%writefile myflow.py

from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```

    Overwriting myflow.py


Another shell command where we run a flow:


```python
#cell_meta:show_steps=start
! python myflow.py run
```

    <span class="ansi-magenta-intense-fg ansi-bold">Metaflow 2.5.0.post6+git62f5e52</span><span class="ansi-magenta-fg"> executing </span><span class="ansi-red-intense-fg ansi-bold">MyFlow</span><span class="ansi-magenta-fg"> for </span><span class="ansi-red-intense-fg ansi-bold">user:hamel</span>
    <span class="ansi-magenta-fg">Validating your flow...</span>
    <span class="ansi-green-intense-fg ansi-bold">    The graph looks good!</span>
    <span class="ansi-magenta-fg">Running pylint...</span>
    <span class="ansi-green-intense-fg ansi-bold">    Pylint is happy!</span>
    <span class="ansi-magenta-fg">2022-02-15 14:11:09.216 </span><span class="ansi-bold">Workflow starting (run-id 1644963069213536):</span>
    <span class="ansi-magenta-fg">2022-02-15 14:11:09.224 </span><span class="ansi-green-fg">[1644963069213536/start/1 (pid 46840)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:11:09.858 </span><span class="ansi-green-fg">[1644963069213536/start/1 (pid 46840)] </span>this is the start
    <span class="ansi-magenta-fg">2022-02-15 14:11:09.929 </span><span class="ansi-green-fg">[1644963069213536/start/1 (pid 46840)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:11:09.936 </span><span class="ansi-green-fg">[1644963069213536/train/2 (pid 46845)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:11:10.556 </span><span class="ansi-green-fg">[1644963069213536/train/2 (pid 46845)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:11:10.626 </span><span class="ansi-green-fg">[1644963069213536/train/2 (pid 46845)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:11:10.633 </span><span class="ansi-green-fg">[1644963069213536/end/3 (pid 46850)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:11:11.249 </span><span class="ansi-green-fg">[1644963069213536/end/3 (pid 46850)] </span>this is the end
    <span class="ansi-magenta-fg">2022-02-15 14:11:11.315 </span><span class="ansi-green-fg">[1644963069213536/end/3 (pid 46850)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:11:11.315 </span><span class="ansi-bold">Done!</span>
    

This is a normal python cell:


```python
a = 2
a
```




    2



The next cell has a cell tag of `remove_input`, so you should only see the output of the cell:


```python
print(&#39;hello, you should not see the print statement that produced me&#39;)
```

    hello, you should not see the print statement that produced me



```python

```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is the same notebook, but with all of the preprocessors that we defined in this module.  Additionally, we hide the input of the last cell which prints <code>hello, you should not see the print statement...</code> by using the built in <code>TagRemovePreprocessor</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span> <span class="o">=</span> <span class="n">get_mdx_exporter</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;test_files/example_input.ipynb&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>---
title: my hello page title
description: my hello page description
hide_table_of_contents: true
---


&lt;!--- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location &amp; name as this file.--&gt;

## This is a test notebook

This is a shell command:


```bash
echo hello
```

    hello


We are writing a python script to disk:


```py title=&#34;myflow.py&#34;
from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```

Another shell command where we run a flow:


```bash
python myflow.py run
```

    2022-02-15 14:11:09.224 [1644963069213536/start/1 (pid 46840)] Task is starting.
    2022-02-15 14:11:09.858 [1644963069213536/start/1 (pid 46840)] this is the start
    2022-02-15 14:11:09.929 [1644963069213536/start/1 (pid 46840)] Task finished successfully.
    ...

This is a normal python cell:


```python
a = 2
a
```




    2



The next cell has a cell tag of `remove_input`, so you should only see the output of the cell:


```python
print(&#39;hello, you should not see the print statement that produced me&#39;)
```

    hello, you should not see the print statement that produced me


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

