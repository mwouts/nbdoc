---

title: Parse Python Modules For API Reference Docs


keywords: fastai
sidebar: home_sidebar

summary: "Parse python modules and extract components (signatures, docstrings, etc) to be exported to MDX."
description: "Parse python modules and extract components (signatures, docstrings, etc) to be exported to MDX."
nb_path: "nbs/apiref.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/apiref.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Parsed" class="doc_header"><code>class</code> <code>Parsed</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/apiref.py#L10" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Parsed</code>(<strong><code>tree</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ParsedFunc" class="doc_header"><code>class</code> <code>ParsedFunc</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/apiref.py#L19" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ParsedFunc</code>(<strong><code>tree</code></strong>) :: <a href="/nbdoc/apiref.html#Parsed"><code>Parsed</code></a></p>
</blockquote>
<p>Parse a function in a way that is amenable to show in the docs.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's take the below function as an example.  We can parse it and get its constituent parts:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_t</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;test_files/test_lib/script.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
<span class="n">_f</span> <span class="o">=</span> <span class="n">_t</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">_t</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>def func(ms) -&gt; str:
    &#34;&#34;&#34;
    Switch Metadata provider.

    This call has a global effect. Selecting the local metadata will,
    for example, not allow access to information stored in remote
    metadata providers.

    Parameters
    ----------
    ms : string
        Can be a path (selects local metadata), a URL starting with http (selects
        the service metadata) or an explicit specification &lt;metadata_type&gt;@&lt;info&gt;; as an
        example, you can specify local@&lt;path&gt; or service@&lt;url&gt;.

    Returns
    -------
    string
        The description of the metadata selected (equivalent to the result of
        get_metadata())
    &#34;&#34;&#34;
    global current_metadata
    infos = ms.split(&#39;@&#39;, 1)
    return get_metadata()
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we parse the above function we get a number of useful attributes:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_pm</span> <span class="o">=</span> <span class="n">ParsedFunc</span><span class="p">(</span><span class="n">_f</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;ms&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="s2">&quot;global current_metadata</span><span class="se">\n</span><span class="s2">infos = ms.split(&#39;@&#39;, 1)</span><span class="se">\n</span><span class="s2">return get_metadata()&quot;</span><span class="p">)</span> <span class="c1">#docstring is stripped out</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">returns</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">decorators</span><span class="p">,</span> <span class="p">[])</span>
<span class="k">assert</span> <span class="n">_pm</span><span class="o">.</span><span class="n">docstring</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Switch Metadata&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ParsedClass" class="doc_header"><code>class</code> <code>ParsedClass</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/apiref.py#L42" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ParsedClass</code>(<strong><code>tree</code></strong>) :: <a href="/nbdoc/apiref.html#Parsed"><code>Parsed</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similarly, let's parse the below class:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_c</span> <span class="o">=</span> <span class="n">_t</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">_c</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>class Flow(MetaflowObject):
    &#34;&#34;&#34;
    A Flow represents all existing flows with a certain name, in other words,
    classes derived from &#39;FlowSpec&#39;

    As such, it contains all Runs (executions of a flow) related to this flow.

    Attributes
    ----------
    latest_run : Run
        Latest Run (in progress or completed, successfully or not) of this Flow
    latest_successful_run : Run
        Latest successfully completed Run of this Flow
    &#34;&#34;&#34;
    _NAME = &#39;flow&#39;
    _PARENT_CLASS = None
    _CHILD_CLASS = &#39;run&#39;

    def __init__(self, foo, *args, **kwargs):
        super(Flow, self).__init__(*args, **kwargs)

    @property
    def latest_run(self):
        &#34;&#34;&#34;
        Returns the latest run (either in progress or completed) of this flow.

        Note that an in-progress run may be returned by this call. Use latest_successful_run
        to get an object representing a completed successful run.

        Returns
        -------
        Run
            Latest run of this flow
        &#34;&#34;&#34;
        for run in self:
            return run

    @property
    def latest_successful_run(self):
        &#34;&#34;&#34;
        Returns the latest successful run of this flow.

        Returns
        -------
        Run
            Latest successful run of this flow
        &#34;&#34;&#34;
        for run in self:
            if run.successful:
                return run

    @property
    def runs(self, *tags):
        &#34;&#34;&#34;
        Returns an iterator over all the runs in the flow.

        An optional filter is available that allows you to filter on tags.
        If tags are specified, only runs associated with all specified tags
        are returned.

        Parameters
        ----------
        tags : string
            Tags to match

        Returns
        -------
        Iterator[Run]
            Iterator over Run objects in this flow
        &#34;&#34;&#34;
        self.a = 2
        return self._filtered_children(*tags)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we parse this class, we similarly get useful attributes:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_pc</span> <span class="o">=</span> <span class="n">ParsedClass</span><span class="p">(</span><span class="n">_c</span><span class="p">)</span>
<span class="n">_pc</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Flow&#39;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pc</span><span class="o">.</span><span class="n">methods</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># only method is __init__ which is stored seperately, and properties do not count</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pc</span><span class="o">.</span><span class="n">signature</span><span class="p">,</span> <span class="s1">&#39;self, foo, *args, **kwargs&#39;</span><span class="p">)</span> <span class="c1"># the signature is pulled from __init__</span>
<span class="k">assert</span> <span class="n">_pc</span><span class="o">.</span><span class="n">docstring</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;A Flow represents all existing flows&quot;</span><span class="p">)</span> <span class="c1"># The class-level docstring</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ParsedModule" class="doc_header"><code>class</code> <code>ParsedModule</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/apiref.py#L67" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ParsedModule</code>(<strong><code>basedir</code></strong>:<code>str</code>, <strong><code>filepath</code></strong>:<code>str</code>) :: <a href="/nbdoc/apiref.html#Parsed"><code>Parsed</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/apiref.html#ParsedModule"><code>ParsedModule</code></a> parses python modules:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_basedir</span><span class="o">=</span><span class="s1">&#39;test_files/&#39;</span>
<span class="n">_file_path</span> <span class="o">=</span> <span class="s1">&#39;test_files/test_lib/script.py&#39;</span>
<span class="n">_pm</span> <span class="o">=</span> <span class="n">ParsedModule</span><span class="p">(</span><span class="n">_basedir</span><span class="p">,</span> <span class="n">_file_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The reason we pass <code>basedir</code> and <code>filepath</code> so we can calculate various paths for writing markdown files:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;test_lib&#39;</span><span class="p">)</span> <span class="c1"># need this to link back to GitHub from the docs</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s1">&#39;test_lib/script&#39;</span><span class="p">)</span> <span class="c1"># this is the directory that markdown from this module would be written into</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">)</span> <span class="c1"># This is the stem of the python file</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have access to useful attributes:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">class_names</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Metaflow&#39;</span><span class="p">,</span><span class="s1">&#39;MetaflowObject&#39;</span><span class="p">,</span><span class="s1">&#39;MetaflowData&#39;</span><span class="p">,</span><span class="s1">&#39;Flow&#39;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_pm</span><span class="o">.</span><span class="n">func_names</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">,</span><span class="s1">&#39;get_metadata&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can access methods from classes as well:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_pm</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;MetaflowObject&#39;</span><span class="p">:</span>
        <span class="c1"># the signature, or __init__ of `MetaflowObject` in our test data</span>
        <span class="n">test_eq</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">signature</span><span class="p">,</span> <span class="s1">&#39;self, pathspec=None, attempt=None, _object=None, _parent=None, _namespace_check=True&#39;</span><span class="p">)</span>
        <span class="n">_tst_methods</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">methods</span>
        
<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_tst_methods</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># there is only one method we want to show from the MetaflowObject besides __init__</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_tst_methods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;is_in_namespace&#39;</span><span class="p">)</span> <span class="c1"># the name of this method is `is_in_namespace`</span>
<span class="k">assert</span> <span class="n">_tst_methods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">docstring</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Returns whether this object is in the current namespace.&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

